<!DOCTYPE html>
<html lang="en">
    <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenodo</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="Martin Fenner" />

    <!-- RDFa Metadata (in DublinCore) -->
    <meta property="dc:title" content="Zenodo" />
    <meta property="dc:creator" content="" />
    <meta name="citation_publication_date" content=""/>
    <meta property="dc:format" content="text/html" />
    <meta property="dc:language" content="en" />
    <meta property="dc:identifier" content="/docs/zenodo_integration/" />
    <meta property="dc:rights" content="CC-BY" />
    <meta property="dc:source" content="Lagotto" />
    <meta property="dc:subject" content="Scholarly Communication" />
    <meta property="dc:type" content="website" />

    <!-- Google Scholar Metadata -->
    <meta name="citation_author" content=""/>
    <meta name="citation_publication_date" content=""/>
    <meta name="citation_title" content="Zenodo"/>
    <meta name="citation_journal_title" content="Lagotto"/>

    <link rel="alternate" type="application/rss+xml" title="Lagotto" href="/rss.xml" />
    <link rel="alternate" type="application/atom+xml" title="Lagotto" href="/atom.xml" />

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,400italic,600italic' rel='stylesheet' type='text/css'>

    <!-- CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-theme.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/github.css">

    <!-- Javascript -->
    <script src="/js/d3.v3.min.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Lagotto</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/">Introduction</a></li>
            <li><a href="/value">Value</a></li>
            <li><a href="/metrics">Metrics</a></li>
            <li><a href="/research">Research</a></li>
            <li><a href="/conferences">Conferences</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Implementations <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/plos">Public Library of Science</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Development <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/docs/">Home</a></li>
            <li><a href="/docs/installation">Installation</a></li>
            <li><a href="/docs/setup">Setup</a></li>
            <li><a href="/docs/sources">Sources</a></li>
            <li><a href="/docs/api">API</a></li>
            <li><a href="/docs/rake">Rake</a></li>
            <li><a href="/docs/alerts">Alerts</a></li>
            <li><a href="/docs/faq">FAQ</a></li>
            <li><a href="/docs/releases">Releases</a></li>
            <li><a href="/docs/roadmap">Roadmap</a></li>
            <li><a href="/docs/contributors">Contributors</a></li>
          </ul>
        </li>
        <li><a href="/examples">Examples</a></li>
        <li><a href="/blog">Blog</a></li>
        <li><a href="/status">Status</a></li>
      </ul>
    </div>
  </div>
</nav>

    <div class="container">
      <div class="page-header">
        <h1>Zenodo</h1>
        <p class="subtitle">
        </p>
      </div>

      <div class="content">
        <div class="row">
          <div class="col-md-9">
            
            <p>Lagotto currently integrates with <a href="http://www.zenodo.org">Zenodo</a> to upload monthly summary reports as well as API snapshots. This document describes building onto this integration in order to add additional files to Zenodo.</p>

<p>This document is targeted at developers or those interested in adding to the Zenodo integration.</p>

<h3 id="toc_0">Exporting generic data to Zenodo with ZenodoDataExport</h3>

<p>There is a <code>ZenodoDataExport</code> model which represents a grouping of files that are to be uploaded to Zenodo as a single <a href="https://zenodo.org/dev#restapi-res-dep">deposition</a>.</p>

<p>Here&#39;s an example pulled from <code>lib/tasks/report.rake</code>:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">data_export = ZenodoDataExport.create!(
  name: &quot;alm_combined_stats_report&quot;,
  files: [alm_combined_stats_zip_record.filepath],
  publication_date: publication_date,
  title: title,
  description: description,
  creators: [ ENV[&#39;CREATOR&#39;] ],
  keywords: ZENODO_KEYWORDS,
  code_repository_url: ENV[&quot;GITHUB_URL&quot;]
)

DataExportJob.perform_later(id: data_export.id)
</code></pre></div>
<p>There are two steps involved with uploading data to Zenodo:</p>

<ul>
<li>First, create the <code>ZenodoDataExport</code> which adds a record the <code>data_exports</code> table in the Lagotto database. <em>This will not perform the upload.</em></li>
<li>Next, create a <code>DataExportJob</code> for the newly created ZenodoDataExport which will handle uploading the data to Zenodo in the background.</li>
</ul>

<p>This is all there is to exporting new kinds of data to Zenodo: make sure the file(s) exist locally, create a <code>ZenodoDataExport</code>, and queue up a <code>DataExportJob</code>.</p>

<p><em>Note: The <code>DataExportJob</code> that runs in the background requires that Redis and Sidekiq are both running. If they are not running then the upload to Zenodo will not start.</em></p>

<h4 id="toc_1">ZenodoDataExport Attributes</h4>

<p>There are a number of attributes you can use to specify what information the resulting Zenodo deposition should have.</p>

<p>Let&#39;s take a moment to briefly walk thru the attributes from the above example:</p>

<ul>
<li><p><strong>name</strong>: this is the internal name of the export used by Lagotto. It is not used to generate data for Zenodo, only so that you or another developer or sysadmin can make sense of the export. For example, there are many monthly reports and the name field is used to indicate the specific report this data export is for.</p></li>
<li><p><strong>files</strong>: a list of filepaths that exist on the local system that are to be uploaded to Zenodo. These will show up as individual <a href="https://zenodo.org/dev#restapi-res-files"> files</a> on the deposition.</p></li>
<li><p><strong>publication_date</strong>: the publication_date to use for the Zenodo deposition</p></li>
<li><p><strong>title</strong>: the title to use for the Zenodo deposition</p></li>
<li><p><strong>description</strong>: the description to use for the Zenodo deposition</p></li>
<li><p><strong>creators</strong>: an array of names to be used as the creators for the Zenodo deposition</p></li>
<li><p><strong>keywords</strong>: the keywords to associate with the Zenodo deposition (used for searching in Zenodo)</p></li>
<li><p><strong>code_repository_url</strong>: the URL that is associated with the code-base that generated this data export. E.g. the Lagotto Github URL.</p></li>
<li><p><strong>url</strong>: this is set after the upload to Zenodo is complete. It will be the publicly accessible URL of the deposition on Zenodo.</p></li>
</ul>

<h4 id="toc_2">When something goes wrong</h4>

<p>If something goes wrong with the upload the following things will happen:</p>

<ul>
<li>the <code>failed_at</code> timestamp will be set on the ZenodoDataExport record</li>
<li>an <code>Alert</code> record will be created which contains backtrace of any exceptions that have occurred</li>
</ul>



            <!-- COinS metadata (for citation managers like Zotero etc), goes in body text -->
<span
  class="Z3988"
  title="ctx_ver=Z39.88-2004
  &amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc
  &amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator
  &amp;rft.title=Zenodo
  &amp;rft.creator=
  &amp;rft.date=
  &amp;rft.language=EN
  &amp;rft.rights=CC0
  &amp;rft_id=http://lagotto.io/docs/zenodo_integration/">
</span>

            
            <hr>
            <footer class="footer" role="contentinfo">
  <iframe src="http://ghbtns.com/github-btn.html?user=lagotto&repo=lagotto&type=watch&count=true"
  allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe>

  <iframe class="github-btn" src="http://ghbtns.com/github-btn.html?user=lagotto&repo=lagotto&type=fork&count=true"
  allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe>

  <p>Maintained by the core team with the help of our <a href="/docs/contributors">contributors</a>.<br/>
  Source code for <a href="https://github.com/lagotto/lagotto">Lagotto application</a> and <a href="https://github.com/lagotto/lagotto.github.io">this website</a> available on Github. <br/> Code licensed under <a href="https://github.com/lagotto/alm/blob/master/LICENSE.md">MIT</a>, documentation under <a href="http://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</p>
</div>

          </div>
        </div>


      </div>
    </div> <!-- /container -->

    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', '']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>