<!DOCTYPE html>
<html lang="en">
    <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eat your own dogfood: lessons learned from building an API</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="Martin Fenner" />

    <!-- RDFa Metadata (in DublinCore) -->
    <meta property="dc:title" content="Eat your own dogfood: lessons learned from building an API" />
    <meta property="dc:creator" content="" />
    <meta name="citation_publication_date" content="2013-08-22T00:00:00+00:00"/>
    <meta property="dc:format" content="text/html" />
    <meta property="dc:language" content="en" />
    <meta property="dc:identifier" content="/blog/2013/08/22/eat-your-own-dogfood-lessons-learned-from-building-an-api/" />
    <meta property="dc:rights" content="CC-BY" />
    <meta property="dc:source" content="Lagotto" />
    <meta property="dc:subject" content="Scholarly Communication" />
    <meta property="dc:type" content="website" />

    <!-- Google Scholar Metadata -->
    <meta name="citation_author" content="Martin Fenner"/>
    <meta name="citation_publication_date" content="2013-08-22"/>
    <meta name="citation_title" content="Eat your own dogfood: lessons learned from building an API"/>
    <meta name="citation_journal_title" content="Lagotto"/>

    <link rel="alternate" type="application/rss+xml" title="Lagotto" href="/rss.xml" />
    <link rel="alternate" type="application/atom+xml" title="Lagotto" href="/atom.xml" />

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,400italic,600italic' rel='stylesheet' type='text/css'>

    <!-- CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-theme.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/github.css">

    <!-- Javascript -->
    <script src="/js/d3.v3.min.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Lagotto</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/">Introduction</a></li>
            <li><a href="/value">Value</a></li>
            <li><a href="/metrics">Metrics</a></li>
            <li><a href="/research">Research</a></li>
            <li><a href="/conferences">Conferences</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Implementations <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/plos">Public Library of Science</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Development <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/docs/">Home</a></li>
            <li><a href="/docs/installation">Installation</a></li>
            <li><a href="/docs/setup">Setup</a></li>
            <li><a href="/docs/sources">Sources</a></li>
            <li><a href="/docs/api">API</a></li>
            <li><a href="/docs/rake">Rake</a></li>
            <li><a href="/docs/alerts">Alerts</a></li>
            <li><a href="/docs/faq">FAQ</a></li>
            <li><a href="/docs/releases">Releases</a></li>
            <li><a href="/docs/roadmap">Roadmap</a></li>
            <li><a href="/docs/contributors">Contributors</a></li>
          </ul>
        </li>
        <li><a href="/examples">Examples</a></li>
        <li><a href="/blog">Blog</a></li>
        <li><a href="/status">Status</a></li>
      </ul>
    </div>
  </div>
</nav>

    <div class="container">
      <div class="page-header">
        <h1>Eat your own dogfood: lessons learned from building an API</h1>
        <p class="subtitle">22 August 2013 by
          
<a href="http://orcid.org/0000-0003-1419-2405">Martin Fenner</a>
        </p>
      </div>

      <div class="content">
        <div class="row">
          <div class="col-md-9">
            
            <p>The PLOS <a href="https://github.com/lagotto/lagotto">Article-Level Metrics
application</a> is open source
software that collects a variety of metrics about scholarly articles.
The application talks to a number of APIs, and in return provides these
metrics via an API. Work on this application therefore involves a lot of
work on APIs, and some of the lessons I learned are summarized below,
including changes we made in the latest <a href="https://github.com/lagotto/lagotto/releases/tag/v.2.8">ALM
2.8</a> release.
Most of the things I mention are fairly obvious, but some of them could
be starting points for a discussion. Good APIs are important for
scholarly content, as we increasingly use computers to extract relevant
information out of papers – see for example the cool projects done at
the <a href="http://hack4ac.com/">hack4ac event</a> last month, including the one
on <a href="https://www.writelatex.com/blog/32-hack4ac-text-mining-and-analyzing-author-contributions-in-plos-articles">PLOS author
contributions</a> that
I participated in.</p>

<h3 id="toc_0">Eat your own dogfood</h3>

<p>The first rule for building a good API is to use it yourself. The PLOS
ALM API is used by the PLOS journal websites, <a href="http://almreports.plos.org/">ALM
Reports</a>, and the <a href="http://blogs.plos.org/plos/2010/06/search-faster-and-smarter-with-plos/">PLOS
Search</a>
indexer, altogether more than 8 million API requests every month.
Heavily using your own API makes sure that you quickly find and fix
bugs, and that you build an API that is fun to use.</p>

<p><a href="http://www.flickr.com/photos/jbcurio/3910689175/" title="Vintage Ad #910: Doggie Donuts von jbcurio bei Flickr"><img src="http://farm3.staticflickr.com/2430/3910689175_f6d9fc2bc9.jpg" alt="Vintage Ad \#910: Doggie
Donuts"></a></p>

<p><em>Doggie Donuts. Flickr Foto by <a href="http://www.flickr.com/photos/jbcurio/">Jamie</a>.</em></p>

<p>I use the <a href="http://ropensci.github.io/rplos/">rplos</a> and
<a href="https://github.com/ropensci/alm">alm</a> R packages to retrieve data from
the PLOS Search and PLOS ALM APIs for most of my visualizations – the R
statistical computing language is great for this purpose. Working with
these APIs via an R client library can again provide valuable feedback
not only for improving the ALM API, but also to make the <strong>rplos</strong> and
<strong>alm</strong> packages better – and Scott Chamberlain from the
<a href="http://ropensci.org/">rOpenSci</a> project is very quick with updates.</p>

<h3 id="toc_1">Document your API</h3>

<p>Documentation is important for all software, and that of course also
includes APIs. The documentation for the Lagotto API is in <a href="https://github.com/lagotto/lagotto/blog/master/docs/api.md">Github</a>. In the latest
ALM release we have included the documentation right in the ALM
application to make it easier to use, e.g. with the documentation for
the PubMed API right next to the PubMed configuration tab. You also see
the documentation when you sign up for an API key (see below).</p>

<p><img src="/assets/documentation.png" alt="documentation"></p>

<h3 id="toc_2">Make it simple to sign up for an API key</h3>

<p>Most APIs require API keys, although some of them (e.g. Wikipedia) are
fine with identification via the U*ser-Agent* header. API keys are not
so much passwords to gain access to restricted information, but rather
identifiers so that API providers know who is talking to them. For
access to restricted resources we need something more secure e.g.
authentication via <a href="https://dev.twitter.com/docs/auth/oauth">OAuth</a> or
restriction by IP address.</p>

<p>In ALM 2.8 we made it much easier to register for an API key: simply
sign in to <a href="http://alm.plos.org">alm.plos.org</a> using your <a href="http://register.plos.org">PLOS
Journals</a> account – the same account you use
to receive <a href="http://blogs.plos.org/everyone/2013/07/31/new-customized-plos-one-email-alerts-by-subject-area/">customized email alerts for new
articles</a>,
or to make article comments (we are using the
<a href="http://www.jasig.org/cas">CAS</a> protocol for this).</p>

<p><img src="/assets/login.png" alt="login"></p>

<p>For other organizations installing the ALM software we provide two other
options: <a href="http://www.mozilla.org/en-US/persona/">Mozilla
Persona</a> and <a href="http://developer.github.com/v3/oauth/">Github
OAuth</a>. Persona doesn’t require
any configuration and is very straightforward to use, Github OAuth is
nice since many API users probably already have a Github account.</p>

<p><img src="/assets/persona.png" alt="persona"></p>

<h3 id="toc_3">Version your API</h3>

<p>No API is perfect and you will make changes over time. The only way to
strike the right balance between a stable API that doesn’t break, and
making changes that improve the API is to use API versioning, giving
users time to transition to a new API. The ALM API is currently at
version 3, and you indicate the API version in the URL:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">http://alm.plos.org/api/v3/articles?api_key=123&amp;ids=10.1371%2Fjournal.pmed.0020124
</code></pre></div>
<p>We will retire the old v2 APi that was launched in July 2012 on
September 15.</p>

<h3 id="toc_4">REST is not REST</h3>

<p>Most modern APIs are REST APIs. But there are many different ways how
details can be implemented. I am mostly following the <a href="http://shop.oreilly.com/product/0636920021575.do">REST API Design
Rulebook</a>, and this
also includes this rule:</p>

<blockquote>
<p>File extensions should not be included in URIs.</p>
</blockquote>

<p>The ALM API supports both JSON and XML responses, and the format has to
be specified using the <em>Content-Type</em> header, defaulting to JSON. I’m
considering adding a query string such as <strong>&amp;format=xml</strong> to make it
easier for web browsers to do content negotiation.</p>

<p>Another example is returning the <strong>404</strong> (**Not Found**) status code
when a resource can’t be found. Mendeley is the only API that the ALM
application is talking to itself that is also following this
recommendation, the other APIs return a <strong>200</strong> (**OK**) status code
even when they have no information about an article.</p>

<p>Something that almost never works in my experience is “automatic” REST
APIs that automatically translate your database model. I very much
prefer an intermediate layer between model and API (I use
the <a href="https://github.com/drapergem/draper">Draper</a> decorator and
the <a href="https://github.com/nesquena/rabl">RABL</a> templating system) that
lets me decide how I present the information in the API. Another reason
is the versioning mentioned above: it is much easier to do versioning
when the API code is not in the model, but in the presentation layer.</p>

<h3 id="toc_5">Make your API fast</h3>

<p>Many factors go into the speed of an API, and I only want to mention
three things:</p>

<ul>
<li>  speed is important, in particular when looking at metrics for more
than a handful articles</li>
<li>  caching is essential (we use extensive <a href="http://37signals.com/svn/posts/3113-how-key-based-cache-expiration-works">fragment
caching</a>)</li>
<li>  monitoring the performance of your API can help find bottlenecks</li>
</ul>

<p>We collect the duration of all API requests and display the last 10,000
graphically using the <a href="http://d3js.org/">d3.js</a> and
<a href="http://square.github.io/crossfilter/">crossfilter</a> Javascript
libraries. You can see that a typical request takes 150-300 ms, whereas
a cached request can be as quick as 10 ms. This tool was very helpful in
fine-tuning the performance of the API during development.</p>

<p><img src="/assets/duration1.png" alt="duration"></p>

<h3 id="toc_6"> Listen to feedback</h3>

<p>This is an area where we could do much better. There is a <a href="https://groups.google.com/forum/?fromgroups#!forum/plos-api-developers">PLOS API
mailing list</a>
and a <a href="https://github.com/lagotto/lagotto/issues">Github issue tracker</a>, and we would
love to get feedback in either of these places. Feedback is important,
as we can’t possible anticipate all the uses of the API.</p>



            <!-- COinS metadata (for citation managers like Zotero etc), goes in body text -->
<span
  class="Z3988"
  title="ctx_ver=Z39.88-2004
  &amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc
  &amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator
  &amp;rft.title=Eat your own dogfood: lessons learned from building an API
  &amp;rft.creator=
  &amp;rft.date=2013-08-22
  &amp;rft.language=EN
  &amp;rft.rights=CC0
  &amp;rft_id=http://lagotto.io/blog/2013/08/22/eat-your-own-dogfood-lessons-learned-from-building-an-api/">
</span>

            
              <hr>
              <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_shortname = 'lagotto'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
            
            <hr>
            <footer class="footer" role="contentinfo">
  <iframe src="http://ghbtns.com/github-btn.html?user=lagotto&repo=lagotto&type=watch&count=true"
  allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe>

  <iframe class="github-btn" src="http://ghbtns.com/github-btn.html?user=lagotto&repo=lagotto&type=fork&count=true"
  allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe>

  <p>Maintained by the core team with the help of our <a href="/docs/Contributors">contributors</a>.<br/>
  Source code for <a href="https://github.com/lagotto/lagotto">Lagotto application</a> and <a href="https://github.com/lagotto/lagotto.github.io">this website</a> available on Github. <br/> Code licensed under <a href="https://github.com/lagotto/alm/blob/master/LICENSE.md">MIT</a>, documentation under <a href="http://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</p>
</div>

          </div>
        </div>


      </div>
    </div> <!-- /container -->

    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', '']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>